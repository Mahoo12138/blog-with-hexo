<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>é¦™æ©™æ´¾ 5P Ubuntu 22.04 å®‰è£… Home Assistant Supervised [ Mahoo12138 ]</title><link rel="stylesheet" href="/css/index.css"><meta name="post"><link rel="stylesheet" href="/css/layouts/post.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="hexo-container"><header></header><main id="content"><article id="post"><h1>é¦™æ©™æ´¾ 5P Ubuntu 22.04 å®‰è£… Home Assistant Supervised</h1><p>ä¸€åˆ‡çš„èµ·å› éƒ½æ˜¯å› ä¸ºæˆ‘ä½¿ç”¨ Docker å®‰è£…çš„ HA æ²¡æ³•ä½¿ç”¨è“ç‰™ï¼Œæ‰€ä»¥æˆ‘æƒ³ç€æ˜¯ä¸æ˜¯å®¹å™¨ç‰ˆçš„ HA æ˜¯ä¸æ˜¯ä¸æ”¯æŒè“ç‰™ï¼ˆè„‘å­æŠ½äº†ï¼‰è¦ä¸æ¢æˆåˆ«çš„ç‰ˆæœ¬è¯•è¯•ï¼Œä¹Ÿå°±æœ‰äº†è¿™ç¯‡åšå®¢çš„è®°å½•ã€‚</p>
<p>é¦–å…ˆçœ‹å®˜æ–¹æ–‡æ¡£ğŸ‘€ï¼Œæ ¹æ® <a target="_blank" rel="noopener" href="https://github.com/home-assistant/architecture/blob/master/adr/0014-home-assistant-supervised.md">Home Assistant Supervised å®˜æ–¹å®‰è£…æŒ‡å—</a>ï¼Œåªèƒ½å®‰è£…åœ¨ Debian 12 Bookworm ä¸Š (no derivatives æ²¡é”™ï¼Œå°±æ˜¯è¿ Ubuntu ä¹Ÿä¸è¡Œ)ï¼Œè™½ç„¶è¯´ OrangePi å®˜æ–¹æä¾›äº† Debian çš„ç³»ç»Ÿé•œåƒï¼Œä½†åšä¸»å·²ç»åœ¨ Ubuntu ä¸Šæ·±è€•å¤šå¹´ï¼Œæš‚ä¸”ä¸æƒ³è„±ç¦»æ¸©æŸ”ä¹¡ï¼Œæ‰€ä»¥å¼€å§‹äº†ç½‘ä¸Šå¯»æ‰¾çº¿ç´¢ï¼Œè¯•ç€çªç ´è¿™ä¸ªé™åˆ¶ã€‚</p>
<p>ä¸€å¼€å§‹æ‰¾åˆ°äº†ä¸€ä¸ªåœ¨ Gist ä¸Šæ‰¾äº†ä¸ªä¸€é”®å®‰è£…è„šæœ¬ï¼Œç»“æœç”±äºå…¶ä¸­æœ‰ä¸€è¡Œé€šè¿‡ curl è¯»å–è¿œç¨‹ç½‘ç»œé…ç½®å†™å…¥æœ¬åœ°çš„<code>/etc/NetworkManager/NetworkManager.conf</code>ï¼Œç„¶åç”±äºé“¾æ¥ä¸­çš„æºæ–‡ä»¶ä¸¢å¤±ï¼Œå†™å…¥äº†ä¸€è¡Œ <code>404: Not Found</code>ï¼Œè¿™è¿˜æ˜¯åæ¥æ‰å‘ç°çš„ï¼›å½“æ—¶æˆ‘ä¸€ä¸‹å°±å‚»äº†ï¼Œ<code>NetworkManager.service</code> æ€ä¹ˆè¿˜å‡ºé—®é¢˜äº†ï¼Œæˆ‘é¦–å…ˆå°±æ˜¯é‡å¯è¯¥æœåŠ¡ï¼Œè¯•äº†å‡ éä¸ç®¡ç”¨ï¼Œé‚£è¿™æ ·æˆ‘åªå¥½é‡å¯å¤§æ³•äº†ï¼Œç»“æœç³Ÿç³•äº†ï¼Œæˆ‘ç›´æ¥è¿ä¸ä¸Š ssh äº†ï¼Œæ€ä¹ˆæŠŠè¿™èŒ¬ç»™å¿˜äº†ã€‚</p>
<p>ä¹‹åæŠŠé¦™æ©™æ´¾æ¥ä¸Šæ˜¾ç¤ºå™¨ï¼Œåœ¨ç½‘ä¸Šæ‰¾äº†åŠå¤©çš„æ’æŸ¥æ–¹æ³•ï¼Œé€šè¿‡å‘½ä»¤æŸ¥è¯¢åˆ°å¯¹åº”çš„æ—¥å¿—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ journalctl -u NetworkManager -b</span><br></pre></td></tr></table></figure>

<p>æ‰å®šä½åˆ°æ˜¯<code>/etc/NetworkManager/NetworkManager.conf</code>çš„é—®é¢˜ï¼Œæ¥ç€ç…§ç€ç›¸å…³æ–‡æ¡£ï¼Œåˆ é™¤è®¾å¤‡ç½‘å¡çŠ¶æ€ç®¡ç†æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /var/lib/NetworkManager/NetworkManager.state</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡å¯ç½‘ç»œæœåŠ¡ï¼Œç½‘ç»œçŠ¶æ€ä¼šåˆ·æ–°å¹¶å†™å…¥ä¸Šè¿°é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> service network-manager start</span><br></pre></td></tr></table></figure>

<p>åç»­ç®—æ˜¯æ‰¾åˆ°ä¸ªé è°±çš„å®‰è£…æ–¹æ³•[^1]ï¼Œç…§ç€æµç¨‹ï¼Œå…ˆå®‰è£…ç›¸å…³ä¾èµ–åŒ…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apt install \</span><br><span class="line">apparmor \</span><br><span class="line">jq \</span><br><span class="line">wget \</span><br><span class="line">curl \</span><br><span class="line">udisks2 \</span><br><span class="line">libglib2.0-bin \</span><br><span class="line">network-manager \</span><br><span class="line">dbus \</span><br><span class="line">lsb-release \</span><br><span class="line">systemd-journal-remote -y</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ‰“å¼€é¦™æ©™æ´¾å®˜æ–¹æä¾›çš„ç³»ç»Ÿé…ç½®å·¥å…·ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rangepi-config</span><br></pre></td></tr></table></figure>

<p>åœ¨ System â†’ Bootenv ä¸­ï¼Œè¿½åŠ ä»¥ä¸‹å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">extraargs=apparmor=1 security=apparmor</span><br><span class="line">systemd.unified_cgroup_hierarchy=0</span><br></pre></td></tr></table></figure>

<p>åˆ†åˆ«æ˜¯å¼€å¯  AppArmor å’Œ CGroupV1 çš„æ”¯æŒï¼Œä¹‹åé‡å¯ç³»ç»Ÿï¼Œç”Ÿæ•ˆé…ç½®ã€‚</p>
<blockquote>
<p>AppArmor (Application Armor)æ˜¯ Linux å†…æ ¸çš„ä¸€ä¸ªå®‰å…¨æ¨¡å—ï¼ŒAppArmor å…è®¸ç³»ç»Ÿç®¡ç†å‘˜å°†æ¯ä¸ªç¨‹åºä¸ä¸€ä¸ªå®‰å…¨é…ç½®æ–‡ä»¶å…³è”ï¼Œä»è€Œé™åˆ¶ç¨‹åºçš„åŠŸèƒ½ã€‚AppArmor æ˜¯ä¸ SELinux ç±»ä¼¼çš„ä¸€ä¸ªè®¿é—®æ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡å®ƒä½ å¯ä»¥æŒ‡å®šç¨‹åºå¯ä»¥è¯»ã€å†™æˆ–è¿è¡Œå“ªäº›æ–‡ä»¶ï¼Œæ˜¯å¦å¯ä»¥æ‰“å¼€ç½‘ç»œç«¯å£ç­‰ã€‚</p>
</blockquote>
<p>å†æ˜¯å®‰è£… Dockerï¼Œå°±è·³è¿‡äº†ï¼Œå¼€å§‹å®‰è£… HAï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://github.com/home-assistant/os-agent/releases/download/1.6.0/os-agent_1.5.1_linux_aarch64.deb</span><br><span class="line">$ dpkg -i os-agent_1.6.0_linux_aarch64.deb</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œå‡ºç°äº†é—®é¢˜äº†ï¼Œä¹Ÿå°±æ˜¯å¼€å¤´æåˆ°çš„ï¼ŒæŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[error] Ubuntu 20.04.5 LTS is not supported!</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç»•è¿‡çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯åŸæ•™ç¨‹è¯„è®ºåŒºä¸­æåˆ°çš„ä¿®æ”¹<code>/etc/os-release</code>æ–‡ä»¶ï¼Œå¯¹ï¼Œå°±æ˜¯æ‰‹åŠ¨ä¿®æ”¹ç³»ç»Ÿå®šä¹‰çš„é…ç½®ï¼š</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- PRETTY_NAME=&quot;Ubuntu 22.04.5 LTS&quot;</span></span><br><span class="line"><span class="addition">+ PRETTY_NAME=&quot;Debian GNU/Linux 12 (bookworm)&quot;</span></span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ç§å°±æ˜¯åœ¨ HA å®˜æ–¹è®ºå›ï¼Œæœ‰è€å…­å‘ç°çš„æ–¹æ³•[^2]ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> BYPASS_OS_CHECK=<span class="literal">true</span> dpkg -i homeassistant-supervised.deb</span><br></pre></td></tr></table></figure>

<p>æ²¡é”™ï¼Œé€šè¿‡é€†å‘åˆ†æäº† <code>homeassistant-supervised.deb</code> æ‰¾åˆ°äº†å®˜æ–¹ç•™ä¸‹çš„åé—¨ã€‚</p>
<p>ä¹‹åå°±æ˜¯ä¸€è·¯ç»¿ç¯ï¼ŒæˆåŠŸåœ°è¿›å…¥åˆ°äº† <code>http://localhost:8123</code>ã€‚</p>
<p>ç„¶åè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œåˆå§‹åŒ–ç¨‹åºæ£€æµ‹åˆ° Docker ä¸­éƒ¨ç½²äº† unhealthy çš„é•œåƒï¼Œå…ˆåˆ é™¤å°±å¥½äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Error installing Home Assistant</span><br><span class="line">Found image in unhealthy image list &#x27;portainer/portainer-ce&#x27; on the host</span><br></pre></td></tr></table></figure>

<p>æœ€åç»ˆäºæ˜¯è¿›å»äº†ï¼Œä¸è¿‡è“ç‰™è¿˜æ˜¯ä¸èƒ½ä½¿ç”¨ï¼Œè¿™è®©æˆ‘é‡æ–°å¼€å§‹æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼Œæ˜¯çš„ï¼Œåœ¨ä½¿ç”¨ Docker éƒ¨ç½² HA æ—¶ï¼Œæˆ‘å·²ç»æŒ‚è½½äº†è“ç‰™ç›¸å…³è®¾å¤‡äº†ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> docker run -d \</span><br><span class="line">	<span class="comment">#...</span></span><br><span class="line">    -v /dev:/dev \</span><br><span class="line">    -v /run/dbus:/run/dbus \</span><br><span class="line">    -v /var/run/dbus:/var/run/dbus \</span><br><span class="line">    homeassistant/home-assistant:2024.5</span><br></pre></td></tr></table></figure>

<p> ç„¶åç°åœ¨è¿™ç¡®å®è·Ÿå®‰è£…çš„ç‰ˆæœ¬æ²¡å¤šå¤§å…³ç³»ï¼Œæ‰€ä»¥æˆ‘å°†é—®é¢˜æ–¹å‘è½¬ç§»åˆ°è“ç‰™æœ¬èº«ä¸Šæ¥ï¼Œå…ˆä½¿ç”¨ç®¡ç†å·¥å…·æŸ¥çœ‹è“ç‰™è®¾å¤‡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ rfkill list all</span><br><span class="line"></span><br><span class="line">0: tpacpi_bluetooth_sw: Bluetooth</span><br><span class="line">    Soft blocked: <span class="built_in">yes</span></span><br><span class="line">    Hard blocked: no</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>rfkill</code>å‘½ä»¤æ¥è‡ªè‹±æ–‡è¯ç»„ <em>radio frequency kill</em> çš„ç¼©å†™ï¼Œå…¶åŠŸèƒ½æ˜¯ç®¡ç†ç³»ç»Ÿä¸­çš„è“ç‰™å’Œ Wi-Fi è®¾å¤‡ï¼Œæ˜¯ä¸€ä¸ªå†…æ ¸çº§åˆ«çš„ç®¡ç†å·¥å…·ã€‚</p>
</blockquote>
<p>å“‡ï¼Œè“ç‰™ç«Ÿç„¶æ²¡å¼€ï¼ŒçœŸç›¸å¤§ç™½äº†ï¼ˆ<strong>Soft blocked: yes</strong>ï¼šè¡¨ç¤ºè“ç‰™è®¾å¤‡å½“å‰è¢«è½¯ä»¶ç¦ç”¨ï¼Œ<strong>Hard blocked: no</strong>ï¼šè¡¨ç¤ºè“ç‰™è®¾å¤‡æ²¡æœ‰è¢«ç¡¬ä»¶ç¦ç”¨ï¼Œå³ç‰©ç†å¼€å…³å¤„äºå¼€å¯çŠ¶æ€ï¼Œæ²¡æœ‰ç‰©ç†é˜»å¡ï¼‰ã€‚</p>
<p>æ¥ç€è‡ªç„¶æ˜¯ä½¿ç”¨å‘½ä»¤ï¼Œè§£é™¤è½¯ä»¶é˜»å¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rfkill unblock 0</span><br></pre></td></tr></table></figure>

<p>æœ€åè¿˜æ˜¯å†³å®šæ¢å› Docker å®‰è£…çš„ HAï¼Œä»¥ä¸‹æ˜¯å¸è½½è„šæœ¬ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> apparmor</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> hassio-apparmor.service</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> hassio-supervisor.service</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl reset-failed</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/systemd/system/hassio-supervisor.service</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/systemd/system/hassio-apparmor.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo docker kill $(sudo docker ps -q) &amp;&amp; sudo docker rm $(sudo docker ps -a -q) </span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /usr/share/hassio</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /usr/sbin/hassio-apparmor</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /usr/sbin/hassio-supervisor</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /usr/bin/ha</span><br></pre></td></tr></table></figure>

<p>æ³¨é‡Šçš„å‘½ä»¤æ˜¯åˆ é™¤å…¨éƒ¨ Docker çš„å®¹å™¨ï¼Œå¦‚æœæ˜¯æ‰è£…çš„ Docker é‚£å°±å…¨ä¸€å¹¶åˆ é™¤äº†ï¼ˆåšä¸»å°±æ˜¯è§‰å¾— Supervised ç‰ˆå¤ªæ•£äº†ï¼Œå®‰è£…äº†ä¸€å †å®¹å™¨ï¼Œæ‰æ”¾å¼ƒçš„ï¼Œé‡å› Docker ç‰ˆï¼‰ã€‚</p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p>[^1]:<a target="_blank" rel="noopener" href="https://gist.github.com/renatoccosta/c30f0b4216c8caaf1f202b0a0561b5d3">Install Home Assistant on OrangePi 5 </a><br>[^2]: <a target="_blank" rel="noopener" href="https://community.home-assistant.io/t/install-on-unbuntu-20-04-5-or-22-04-1/524361/5">Install on Unbuntu 20.04.5 or 22.04.1</a></p>
</article><div id="paginator"></div></main><footer><div class="icon-wrapper in-left"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span></button></div><div class="icon-wrapper in-right"><button class="icon-button" aria-label="change theme"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" height="100%" width="100%"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg></span></button></div><p class="copyright-text"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noreferrer">CC BY-NC-SA 4.0</a><span>Â·</span><a href="https://github.com/ttttonyhe/ouorz-mono" target="_blank" rel="noreferrer">Open Source Software (OSS)</a></p></footer><script src="/js/ouo.js"></script></div></body></html>